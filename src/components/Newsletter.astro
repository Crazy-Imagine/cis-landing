---
import ResponsiveContainer from './ResponsiveContainer.astro';
import Typography from './Typography.astro';
---

<ResponsiveContainer background="bulbs" class="relative z-50">
  <Typography class:list={['mb-10 text-center capitalize text-white']} as="h2" variant="h2">
    Novedades
  </Typography>
  <Typography
    as="p"
    variant="h4"
    class="text-center font-nexaLight text-[18px] text-white md:text-[30px]"
  >
    Â¡Recibe todas las noticias y novedades que tenemos para ti!
  </Typography>
  <div class="m-auto flex items-center justify-center lg:w-1/2">
    <script
      type="text/javascript"
      src="https://api.clientify.net/web-marketing/superforms/script/250755.js"></script>
  </div>
</ResponsiveContainer>

<script>
  document.addEventListener('astro:page-load', () => {
    function onNewsletterLoaded() {
      const form: any = document.querySelector('._form_embedformselectorcpqhgo');
      const input: any = document.querySelector('.form-control95');
      const inputContainer: any = document.querySelector('.form-group95');
      const inputPadding: any = document.querySelector(
        '#fullwidthcontainer span[class="relative deletehover"]'
      );
      const inputPaddingTop: any = document.querySelector(
        '#fullwidthcontainer span[class="relative deletehover"] div'
      );

      const windowWidth = window.innerWidth;

      const button: any = document.querySelector('.btn-subscribe');

      if (input) {
        input.style.backgroundColor = 'transparent';
        windowWidth >= 768
          ? (input.style.border = 'none')
          : (input.style.border = '4px solid #27AAE1');
        input.style.borderTop = '4px solid #27AAE1';
        input.style.borderBottom = '4px solid #27AAE1';
        input.style.borderLeft = '4px solid #27AAE1';
        input.style.padding = '16px';
        windowWidth >= 768
          ? (input.style.borderRadius = '20px 0 0 20px')
          : (input.style.borderRadius = '20px');
        input.style.color = 'white';
        input.style.height = '79px';
      }

      if (inputContainer) {
        inputContainer.style.paddingRight = '0px';
      }

      if (inputPadding) {
        inputPadding.style.padding = '0px';
      }

      if (inputPaddingTop) {
        inputPaddingTop.style.paddingTop = '5px';
      }

      if (button) {
        windowWidth >= 768
          ? (button.style.borderRadius = '0 20px 20px 0')
          : (button.style.borderRadius = '20px');
        button.style.backgroundColor = '#27AAE1';
        windowWidth >= 768 ? (button.style.height = '79px') : (button.style.height = '50px');
      }
    }

    function waitForNewsletter() {
      const newsletterScript = document.querySelector(
        'script[src*="clientify.net/web-marketing/superforms/script/250755.js"]'
      );

      if (newsletterScript) {
        const checkNewsletterContent = () => {
          const newsletterForm =
            document.querySelector('#form-newsletter, .clientify-form, [data-clientify]') ||
            document.querySelector('form[action*="clientify"]');

          if (newsletterForm) {
            onNewsletterLoaded();
            return true;
          }
          return false;
        };

        if (checkNewsletterContent()) {
          return;
        }

        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
              if (checkNewsletterContent()) {
                observer.disconnect();
              }
            }
          });
        });

        observer.observe(document.body, {
          childList: true,
          subtree: true,
        });

        setTimeout(() => {
          observer.disconnect();
          onNewsletterLoaded();
        }, 2500);
      } else {
        setTimeout(waitForNewsletter, 250);
      }
    }

    waitForNewsletter();
  });
</script>
