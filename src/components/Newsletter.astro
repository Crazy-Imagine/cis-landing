---
import ResponsiveContainer from './ResponsiveContainer.astro';
import Typography from './Typography.astro';
---

<ResponsiveContainer background="bulbs" class="relative z-50">
  <Typography class:list={['mb-10 text-center capitalize text-white']} as="h2" variant="h2">
    Novedades
  </Typography>
  <Typography
    as="p"
    variant="h4"
    class="text-center font-nexaLight text-[18px] text-white md:text-[30px]"
  >
    Â¡Recibe todas las noticias y novedades que tenemos para ti!
  </Typography>
  <div class="m-auto flex items-center justify-center lg:w-1/2">
    <script
      type="text/javascript"
      src="https://api.clientify.net/web-marketing/superforms/script/250755.js"></script>
  </div>
</ResponsiveContainer>

<script>
  function onNewsletterLoaded() {
    // Use a more robust approach to get Clientify elements, since classes could change or not be available immediately

    // Give the elements a few tries to appear
    let attempts = 0;
    const maxAttempts = 10;
    const waitTime = 200;

    function styleElements() {
      const inputs = document.querySelectorAll(
        'input[type="email"], input[type="text"], .form-control95'
      );
      const inputContainers = document.querySelectorAll('.form-group, .form-group95');
      const paddingWrappers = document.querySelectorAll(
        '#fullwidthcontainer span[class*="deletehover"]'
      );
      const paddingTopWrappers = document.querySelectorAll(
        '#fullwidthcontainer span[class*="deletehover"] div'
      );
      const buttons = document.querySelectorAll(' .btn-subscribe, input[type="submit"]');

      const windowWidth = window.innerWidth;

      let styledInput = false;
      let styledButton = false;

      // Style input
      inputs.forEach((input: any) => {
        // Only one input may need styling
        if (!styledInput) {
          input.style.backgroundColor = 'transparent';
          if (windowWidth >= 768) {
            input.style.border = 'none';
          } else {
            input.style.border = '4px solid #27AAE1';
          }
          input.style.borderTop = '4px solid #27AAE1';
          input.style.borderBottom = '4px solid #27AAE1';
          input.style.borderLeft = '4px solid #27AAE1';
          input.style.padding = '16px';
          if (windowWidth >= 768) {
            input.style.borderRadius = '20px 0 0 20px';
          } else {
            input.style.borderRadius = '20px';
          }
          input.style.color = 'white';
          input.style.height = '79px';
          styledInput = true;
        }
      });

      // Style input container
      inputContainers.forEach((inputContainer: any) => {
        inputContainer.style.paddingRight = '0px';
      });

      // Style padding elements
      paddingWrappers.forEach((el: any) => {
        el.style.padding = '0px';
      });

      paddingTopWrappers.forEach((el: any) => {
        el.style.paddingTop = '5px';
      });

      // Style subscribe buttons
      buttons.forEach((button: any) => {
        if (
          button.classList.contains('btn-subscribe') ||
          button.type === 'submit' ||
          /suscribete|subscribe/i.test(button.textContent)
        ) {
          if (!styledButton) {
            if (windowWidth >= 768) {
              button.style.borderRadius = '0 20px 20px 0';
            } else {
              button.style.borderRadius = '20px';
            }
            button.style.backgroundColor = '#27AAE1';
            if (windowWidth >= 768) {
              button.style.height = '79px';
            } else {
              button.style.height = '50px';
            }
            styledButton = true;
          }
        }
      });

      // Try again if not found
      if ((!styledInput || !styledButton) && attempts < maxAttempts) {
        attempts++;
        setTimeout(styleElements, waitTime);
      }
    }

    styleElements();
  }

  function waitForNewsletter() {
    const newsletterScript = document.querySelector(
      'script[src*="clientify.net/web-marketing/superforms/script/250755.js"]'
    );

    if (newsletterScript) {
      const checkNewsletterContent = () => {
        const newsletterForm = document.querySelector('#myFormclientify');

        console.log(newsletterForm, '????');

        if (newsletterForm) {
          onNewsletterLoaded();
          return true;
        }
        return false;
      };

      if (checkNewsletterContent()) {
        return;
      }

      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
            if (checkNewsletterContent()) {
              observer.disconnect();
            }
          }
        });
      });

      observer.observe(document.body, {
        childList: true,
        subtree: true,
      });

      setTimeout(() => {
        observer.disconnect();
        onNewsletterLoaded();
      }, 2500);
    } else {
      setTimeout(waitForNewsletter, 250);
    }
  }

  waitForNewsletter();
</script>
