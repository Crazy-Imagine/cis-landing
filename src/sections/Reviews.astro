---
import CarouselSection from './CarouselSection.astro';
import ReviewCard from '@/components/ReviewCard.astro';
import fetchApi from '@/lib/strapi';
import type { ReviewCollection } from '@/types/strapi/Review';
import { getLangFromUrl, useTranslations } from '@/i18n/utils';

interface Props {
  class?: string;
  language?: 'es' | 'en';
}

const { class: className, language } = Astro.props;

const data = await fetchApi<ReviewCollection>({
  endpoint: 'google-review',
  params: {},
});

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<CarouselSection background="bulbs" title={t('common.people-who-work-with-us-say')}>
  <Fragment slot="items">
    {
      data.reviews.map((review, index) => {
        if (review.comment) {
          return <ReviewCard review={review} class={className} language={language} />;
        }

        return null;
      })
    }
  </Fragment>
</CarouselSection>
