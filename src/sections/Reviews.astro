---
import CarouselSection from './CarouselSection.astro';
import ReviewCard from '@/components/ReviewCard.astro';
import fetchApi from '@/lib/strapi';
import type { GoogleReviews } from '@/types/strapi/Review';
import { getLangFromUrl, useTranslations } from '@/i18n/utils';
import type { Background } from '@/types/Background';

interface Props {
  class?: string;
  background?: Background;
}

const { class: className, background = 'bulbs' } = Astro.props;

const data = await fetchApi<GoogleReviews>({
  endpoint: 'google-review',
  params: {},
});

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<CarouselSection background={background} title={t('common.people-who-work-with-us-say')}>
  <Fragment slot="items">
    {
      data.reviews.map((review, index) => {
        if (review.comment) {
          return <ReviewCard review={review} class={className} />;
        }

        return null;
      })
    }
  </Fragment>
</CarouselSection>
